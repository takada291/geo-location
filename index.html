</head>
<body>

<script>
    // --- 【重要】ここからPWA・更新通知用のコードを再追加 ---
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./sw.js').then(reg => {
                // 新しいService Workerがインストールされたか監視
                reg.onupdatefound = () => {
                    const installingWorker = reg.installing;
                    installingWorker.onstatechange = () => {
                        if (installingWorker.state === 'installed') {
                            if (navigator.serviceWorker.controller) {
                                // 更新がある場合にアラートを出す
                                if (confirm("最新バージョンがあります。更新しますか？\n（更新前に現在のデータをCSV出力してください）")) {
                                    // 待機中のSWにメッセージを送る
                                    if (reg.waiting) {
                                        reg.waiting.postMessage({ type: 'SKIP_WAITING' });
                                    }
                                    window.location.reload();
                                }
                            }
                        }
                    };
                };
            }).catch(err => console.error('PWA登録失敗', err));
        });
    }
    // --------------------------------------------------

    // キー名は以前のものを継承
    var STORAGE_KEY = 'forest_survey_final_v3';

    window.onload = function() {
        renderTable();
    };

    // --- (以下、handleSave() 以降の関数はご提示いただいたものと同じでOKです) ---
    function handleSave() {
        // ...ご提示のコード
    }
    // ...renderTable(), startEdit(), handleDelete(), resetForm(), handleExport() と続く
</script>
</body>
</html>
